//
// Created by Jingzhe Yu on 9.5.2024.
//

#include <gtest/gtest.h>
#include <iostream>
#include <JsonParser.h>

using namespace std;

TEST(JsonParserTest, parseHttpResponse) {
    auto response = R"({"routes":[{"weight_name":"auto","weight":745.958,"duration":114.366,"distance":349.796,"legs":[{"via_waypoints":[],"annotation":{"maxspeed":[{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true}],"distance":[13.9,11.7,15.2,12.6,16,15.1,9.1,10.9,29.5,26,19.4,7.4,25.6,17.2,10,27.4,29.2,10.1,15.6,1.2,6.1,8.7,11.9]},"admins":[{"iso_3166_1_alpha3":"FIN","iso_3166_1":"FI"}],"weight":745.958,"duration":114.366,"steps":[{"intersections":[{"classes":["restricted"],"bearings":[1],"entry":[true],"mapbox_streets_v8":{"class":"service"},"is_urban":false,"admin_index":0,"out":0,"geometry_index":0,"location":[25.467315,65.080339]}],"speedLimitUnit":"km/h","maneuver":{"type":"depart","instruction":"Drive north.","bearing_after":1,"bearing_before":0,"location":[25.467315,65.080339]},"speedLimitSign":"vienna","name":"","duration":5.012,"distance":13.922,"driving_side":"right","weight":4.761,"mode":"driving","geometry":{"coordinates":[[25.467315,65.080339],[25.467318,65.080464]],"type":"LineString"}},{"intersections":[{"entry":[true,false,true],"in":1,"bearings":[90,181,272],"duration":4.899,"turn_weight":7,"turn_duration":1.908,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":0,"weight":9.931,"geometry_index":1,"location":[25.467318,65.080464]},{"entry":[true,true,false],"in":2,"bearings":[0,90,270],"duration":3.939,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":1,"weight":4.664,"geometry_index":2,"location":[25.467566,65.080464]},{"entry":[true,true,false],"in":2,"bearings":[91,180,270],"duration":3.228,"turn_weight":1,"turn_duration":0.008,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":0,"weight":4.176,"geometry_index":3,"location":[25.467892,65.080463]},{"entry":[true,true,false],"in":2,"bearings":[0,90,271],"duration":4.12,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":1,"weight":4.909,"geometry_index":4,"location":[25.468159,65.080462]},{"entry":[true,true,false],"in":2,"bearings":[90,182,270],"duration":3.903,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":0,"weight":4.664,"geometry_index":5,"location":[25.4685,65.080461]},{"entry":[true,true,false],"in":2,"bearings":[0,91,270],"duration":2.336,"turn_weight":1,"turn_duration":0.008,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":1,"weight":3.199,"geometry_index":6,"location":[25.468823,65.080461]},{"bearings":[91,180,271],"entry":[true,true,false],"in":2,"turn_weight":1,"turn_duration":0.008,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":0,"geometry_index":7,"location":[25.469016,65.08046]}],"speedLimitUnit":"km/h","maneuver":{"type":"turn","instruction":"Turn right onto Ketunkäpälä.","modifier":"right","bearing_after":90,"bearing_before":1,"location":[25.467318,65.080464]},"speedLimitSign":"vienna","name":"Ketunkäpälä","duration":25.255,"distance":90.621,"driving_side":"right","weight":35.23,"mode":"driving","geometry":{"coordinates":[[25.467318,65.080464],[25.467566,65.080464],[25.467892,65.080463],[25.468159,65.080462],[25.4685,65.080461],[25.468823,65.080461],[25.469016,65.08046],[25.46925,65.080459]],"type":"LineString"}},{"intersections":[{"entry":[true,false,true],"in":1,"bearings":[177,271,357],"duration":14.448,"turn_weight":10,"turn_duration":5.622,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":18.265,"geometry_index":8,"location":[25.46925,65.080459]},{"entry":[true,false,true],"in":1,"bearings":[63,177,357],"duration":7.831,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":8.41,"geometry_index":9,"location":[25.46922,65.080723]},{"entry":[true,false,true],"in":1,"bearings":[61,177,354],"duration":5.838,"turn_weight":1,"turn_duration":0.024,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":6.415,"geometry_index":10,"location":[25.469193,65.080957]},{"entry":[false,true,true],"in":0,"bearings":[174,267,347],"duration":2.261,"turn_weight":1,"turn_duration":0.036,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":2.995,"geometry_index":11,"location":[25.469147,65.08113]},{"entry":[true,false,true],"in":1,"bearings":[63,167,347],"duration":7.686,"turn_weight":1,"turn_duration":0.021,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":8.215,"geometry_index":12,"location":[25.469112,65.081195]},{"entry":[true,false,true],"in":1,"bearings":[77,167,347],"duration":8.181,"turn_weight":1,"turn_duration":0.021,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":8.493,"geometry_index":13,"location":[25.468993,65.081419]},{"bearings":[44,165,340],"entry":[true,false,true],"in":1,"turn_weight":1,"turn_duration":0.024,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"geometry_index":15,"location":[25.468853,65.081656]}],"speedLimitUnit":"km/h","maneuver":{"type":"end of road","instruction":"Turn left onto Ketunlenkki.","modifier":"left","bearing_after":357,"bearing_before":91,"location":[25.46925,65.080459]},"speedLimitSign":"vienna","name":"Ketunlenkki","duration":54.499,"distance":162.484,"driving_side":"right","weight":61.285,"mode":"driving","geometry":{"coordinates":[[25.46925,65.080459],[25.46922,65.080723],[25.469193,65.080957],[25.469147,65.08113],[25.469112,65.081195],[25.468993,65.081419],[25.468913,65.08157],[25.468853,65.081656],[25.468656,65.081888]],"type":"LineString"}},{"intersections":[{"entry":[false,true,true],"in":0,"bearings":[160,258,341],"duration":10.516,"turn_weight":10,"turn_duration":4.345,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":1,"weight":15.681,"geometry_index":16,"location":[25.468656,65.081888]},{"entry":[false,true,true],"in":0,"bearings":[78,168,258],"duration":2.15,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":2.959,"geometry_index":17,"location":[25.468048,65.081834]},{"entry":[false,true,true],"in":0,"bearings":[78,258,351],"duration":3.317,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":1,"weight":4.219,"geometry_index":18,"location":[25.467837,65.081815]},{"entry":[false,true,true],"in":0,"bearings":[78,265,351],"duration":0.271,"turn_weight":1,"turn_duration":0.012,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":1,"weight":1.201,"geometry_index":19,"location":[25.467511,65.081786]},{"bearings":[85,175,270],"entry":[false,true,true],"in":0,"turn_weight":1,"turn_duration":0.01,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"geometry_index":20,"location":[25.467485,65.081785]}],"speedLimitUnit":"km/h","maneuver":{"type":"turn","instruction":"Turn left onto Naalinkulku.","modifier":"left","bearing_after":258,"bearing_before":340,"location":[25.468656,65.081888]},"speedLimitSign":"vienna","name":"Naalinkulku","duration":19.395,"distance":70.896,"driving_side":"right","weight":28.077,"mode":"driving","geometry":{"coordinates":[[25.468656,65.081888],[25.468048,65.081834],[25.467837,65.081815],[25.467511,65.081786],[25.467485,65.081785],[25.467356,65.081779],[25.467171,65.081784]],"type":"LineString"}},{"intersections":[{"bearings":[90,174,275],"entry":[false,true,true],"classes":["restricted"],"in":0,"turn_weight":612.5,"turn_duration":5.93,"mapbox_streets_v8":{"class":"service"},"is_urban":false,"admin_index":0,"out":1,"geometry_index":22,"location":[25.467171,65.081784]}],"speedLimitUnit":"km/h","maneuver":{"type":"turn","instruction":"Turn left.","modifier":"left","bearing_after":174,"bearing_before":270,"location":[25.467171,65.081784]},"speedLimitSign":"vienna","name":"","duration":10.204,"distance":11.873,"driving_side":"right","weight":616.604,"mode":"driving","geometry":{"coordinates":[[25.467171,65.081784],[25.467199,65.081678]],"type":"LineString"}},{"intersections":[{"bearings":[354],"entry":[true],"in":0,"admin_index":0,"geometry_index":23,"location":[25.467199,65.081678]}],"speedLimitUnit":"km/h","maneuver":{"type":"arrive","instruction":"You have arrived at your destination.","bearing_after":0,"bearing_before":174,"location":[25.467199,65.081678]},"speedLimitSign":"vienna","name":"","duration":0,"distance":0,"driving_side":"right","weight":0,"mode":"driving","geometry":{"coordinates":[[25.467199,65.081678],[25.467199,65.081678]],"type":"LineString"}}],"distance":349.796,"summary":"Ketunkäpälä, Ketunlenkki"}],"geometry":{"coordinates":[[25.467315,65.080339],[25.467318,65.080464],[25.467566,65.080464],[25.467892,65.080463],[25.468159,65.080462],[25.4685,65.080461],[25.468823,65.080461],[25.469016,65.08046],[25.46925,65.080459],[25.46922,65.080723],[25.469193,65.080957],[25.469147,65.08113],[25.469112,65.081195],[25.468993,65.081419],[25.468913,65.08157],[25.468853,65.081656],[25.468656,65.081888],[25.468048,65.081834],[25.467837,65.081815],[25.467511,65.081786],[25.467485,65.081785],[25.467356,65.081779],[25.467171,65.081784],[25.467199,65.081678]],"type":"LineString"}},{"weight_name":"auto","weight":783.161,"duration":127.378,"distance":600.278,"legs":[{"via_waypoints":[],"annotation":{"maxspeed":[{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"unknown":true},{"speed":40,"unit":"km/h"},{"speed":40,"unit":"km/h"},{"speed":40,"unit":"km/h"},{"speed":40,"unit":"km/h"},{"speed":40,"unit":"km/h"},{"speed":40,"unit":"km/h"},{"speed":40,"unit":"km/h"},{"speed":40,"unit":"km/h"},{"speed":40,"unit":"km/h"},{"speed":40,"unit":"km/h"},{"unknown":true},{"unknown":true},{"unknown":true}],"distance":[13.9,11.7,15.2,12.6,16,15.1,9.1,10.9,1.2,24.9,31,4.8,3.4,2.9,2.3,4.8,5.5,4.9,9.8,16.9,13.5,19.1,8.1,19,10,4.7,13.9,13.7,8.7,9.6,20.7,43.5,18.2,17.5,6.3,51.1,42,10.2,9.4,8.5,23.8,11.9]},"admins":[{"iso_3166_1_alpha3":"FIN","iso_3166_1":"FI"}],"weight":783.161,"duration":127.378,"steps":[{"intersections":[{"classes":["restricted"],"bearings":[1],"entry":[true],"mapbox_streets_v8":{"class":"service"},"is_urban":false,"admin_index":0,"out":0,"geometry_index":0,"location":[25.467315,65.080339]}],"speedLimitUnit":"km/h","maneuver":{"type":"depart","instruction":"Drive north.","bearing_after":1,"bearing_before":0,"location":[25.467315,65.080339]},"speedLimitSign":"vienna","name":"","duration":5.012,"distance":13.922,"driving_side":"right","weight":4.761,"mode":"driving","geometry":{"coordinates":[[25.467315,65.080339],[25.467318,65.080464]],"type":"LineString"}},{"intersections":[{"entry":[true,false,true],"in":1,"bearings":[90,181,272],"duration":4.899,"turn_weight":7,"turn_duration":1.908,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":0,"weight":9.931,"geometry_index":1,"location":[25.467318,65.080464]},{"entry":[true,true,false],"in":2,"bearings":[0,90,270],"duration":3.939,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":1,"weight":4.664,"geometry_index":2,"location":[25.467566,65.080464]},{"entry":[true,true,false],"in":2,"bearings":[91,180,270],"duration":3.228,"turn_weight":1,"turn_duration":0.008,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":0,"weight":4.176,"geometry_index":3,"location":[25.467892,65.080463]},{"entry":[true,true,false],"in":2,"bearings":[0,90,271],"duration":4.12,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":1,"weight":4.909,"geometry_index":4,"location":[25.468159,65.080462]},{"entry":[true,true,false],"in":2,"bearings":[90,182,270],"duration":3.903,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":0,"weight":4.664,"geometry_index":5,"location":[25.4685,65.080461]},{"entry":[true,true,false],"in":2,"bearings":[0,91,270],"duration":2.336,"turn_weight":1,"turn_duration":0.008,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":1,"weight":3.199,"geometry_index":6,"location":[25.468823,65.080461]},{"bearings":[91,180,271],"entry":[true,true,false],"in":2,"turn_weight":1,"turn_duration":0.008,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":0,"geometry_index":7,"location":[25.469016,65.08046]}],"speedLimitUnit":"km/h","maneuver":{"type":"turn","instruction":"Turn right onto Ketunkäpälä.","modifier":"right","bearing_after":90,"bearing_before":1,"location":[25.467318,65.080464]},"speedLimitSign":"vienna","name":"Ketunkäpälä","duration":25.255,"distance":90.621,"driving_side":"right","weight":35.23,"mode":"driving","geometry":{"coordinates":[[25.467318,65.080464],[25.467566,65.080464],[25.467892,65.080463],[25.468159,65.080462],[25.4685,65.080461],[25.468823,65.080461],[25.469016,65.08046],[25.46925,65.080459]],"type":"LineString"}},{"intersections":[{"entry":[true,false,true],"in":1,"bearings":[178,271,358],"duration":2.065,"turn_weight":7,"turn_duration":1.814,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":0,"weight":7.214,"geometry_index":8,"location":[25.46925,65.080459]},{"entry":[true,true,false],"in":2,"bearings":[90,177,358],"duration":5.637,"turn_weight":1,"turn_duration":0.019,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":1,"weight":6.344,"geometry_index":9,"location":[25.469251,65.080449]},{"entry":[true,true,false],"in":2,"bearings":[61,177,357],"duration":6.992,"turn_weight":1,"turn_duration":0.019,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":1,"weight":7.626,"geometry_index":10,"location":[25.469279,65.080225]},{"bearings":[89,197,357],"entry":[true,true,false],"in":2,"turn_weight":1.5,"turn_duration":0.025,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":1,"geometry_index":11,"location":[25.469314,65.079947]}],"speedLimitUnit":"km/h","maneuver":{"type":"end of road","instruction":"Turn right onto Ketunlenkki.","modifier":"right","bearing_after":178,"bearing_before":91,"location":[25.46925,65.080459]},"speedLimitSign":"vienna","name":"Ketunlenkki","duration":17.219,"distance":68.186,"driving_side":"right","weight":25.035,"mode":"driving","geometry":{"coordinates":[[25.46925,65.080459],[25.469251,65.080449],[25.469279,65.080225],[25.469314,65.079947],[25.469309,65.079904],[25.469284,65.079875],[25.469248,65.079854]],"type":"LineString"}},{"intersections":[{"entry":[false,true,true],"in":0,"bearings":[17,104,256],"duration":3.165,"turn_weight":2,"turn_duration":0.348,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":4.779,"geometry_index":14,"location":[25.469248,65.079854]},{"entry":[true,false,true],"in":1,"bearings":[1,76,270],"duration":1.126,"turn_weight":1.5,"turn_duration":0.018,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":2.569,"geometry_index":17,"location":[25.468997,65.079828]},{"entry":[false,true,true],"in":0,"bearings":[90,179,270],"duration":2.223,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":3.137,"geometry_index":18,"location":[25.468892,65.079828]},{"entry":[false,true,true],"in":0,"bearings":[90,179,270],"duration":3.806,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":4.634,"geometry_index":19,"location":[25.468682,65.079828]},{"entry":[false,true,true],"in":0,"bearings":[90,270,332],"duration":3.036,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":1,"weight":3.779,"geometry_index":20,"location":[25.468322,65.079829]},{"entry":[false,true,true],"in":0,"bearings":[90,177,270],"duration":4.302,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":5.061,"geometry_index":21,"location":[25.468035,65.079829]},{"entry":[true,false,true],"in":1,"bearings":[28,90,270],"duration":1.833,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":2.71,"geometry_index":22,"location":[25.467628,65.07983]},{"entry":[false,true,true],"in":0,"bearings":[90,180,270],"duration":4.292,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":5.061,"geometry_index":23,"location":[25.467455,65.07983]},{"entry":[true,false,true],"in":1,"bearings":[0,90,269],"duration":2.257,"turn_weight":1,"turn_duration":0.019,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":3.137,"geometry_index":24,"location":[25.467049,65.079831]},{"entry":[false,true,true],"in":0,"bearings":[89,187,270],"duration":1.063,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"weight":2.069,"geometry_index":25,"location":[25.466837,65.079829]},{"entry":[false,true,true],"in":0,"bearings":[90,263,356],"duration":3.159,"turn_weight":1,"turn_duration":0.03,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":1,"weight":3.993,"geometry_index":26,"location":[25.466737,65.079829]},{"entry":[false,true,false],"in":0,"bearings":[83,263,359],"duration":3.101,"turn_weight":1,"turn_duration":0.007,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":1,"weight":3.993,"geometry_index":27,"location":[25.466443,65.079813]},{"bearings":[83,180,267,353],"entry":[false,false,true,false],"in":0,"turn_weight":2,"turn_duration":0.009,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":2,"geometry_index":28,"location":[25.466152,65.079798]}],"speedLimitUnit":"km/h","maneuver":{"type":"end of road","instruction":"Turn right to stay on Ketunlenkki.","modifier":"right","bearing_after":256,"bearing_before":197,"location":[25.469248,65.079854]},"speedLimitSign":"vienna","name":"Ketunlenkki","duration":35.327,"distance":154.876,"driving_side":"right","weight":48.845,"mode":"driving","geometry":{"coordinates":[[25.469248,65.079854],[25.469211,65.079841],[25.469114,65.079828],[25.468997,65.079828],[25.468892,65.079828],[25.468682,65.079828],[25.468322,65.079829],[25.468035,65.079829],[25.467628,65.07983],[25.467455,65.07983],[25.467049,65.079831],[25.466837,65.079829],[25.466737,65.079829],[25.466443,65.079813],[25.466152,65.079798],[25.465967,65.079794]],"type":"LineString"}},{"intersections":[{"entry":[false,true,true],"in":0,"bearings":[87,177,355],"duration":3.239,"turn_weight":8,"turn_duration":1.908,"mapbox_streets_v8":{"class":"tertiary"},"is_urban":false,"admin_index":0,"out":2,"weight":9.315,"geometry_index":29,"location":[25.465967,65.079794]},{"entry":[false,false,false,true],"in":1,"bearings":[84,175,263,354],"duration":8.906,"turn_weight":1.5,"turn_duration":0.021,"mapbox_streets_v8":{"class":"tertiary"},"is_urban":false,"admin_index":0,"out":3,"weight":9.918,"geometry_index":30,"location":[25.465948,65.07988]},{"entry":[false,false,false,true],"in":1,"bearings":[84,172,265,356],"duration":2.527,"turn_weight":1.5,"turn_duration":0.009,"mapbox_streets_v8":{"class":"tertiary"},"is_urban":false,"admin_index":0,"out":3,"weight":3.868,"geometry_index":32,"location":[25.46578,65.080452]},{"entry":[true,false,true],"in":1,"bearings":[7,176,270],"duration":2.113,"turn_weight":1.5,"turn_duration":0.014,"mapbox_streets_v8":{"class":"tertiary"},"is_urban":false,"admin_index":0,"out":0,"weight":3.438,"geometry_index":33,"location":[25.465755,65.080615]},{"entry":[true,false,false,false],"in":2,"bearings":[15,94,187,276],"duration":13.163,"turn_weight":1.5,"turn_duration":0.012,"mapbox_streets_v8":{"class":"tertiary"},"is_urban":false,"admin_index":0,"out":0,"weight":14.04,"geometry_index":34,"location":[25.465799,65.080771]},{"bearings":[9,97,193,279],"entry":[true,false,false,false],"in":2,"turn_weight":1.5,"turn_duration":0.026,"mapbox_streets_v8":{"class":"tertiary"},"is_urban":false,"admin_index":0,"out":0,"geometry_index":38,"location":[25.466451,65.081715]}],"speedLimitUnit":"km/h","maneuver":{"type":"end of road","instruction":"Turn right onto Eränkävijäntaival.","modifier":"right","bearing_after":355,"bearing_before":267,"location":[25.465967,65.079794]},"speedLimitSign":"vienna","name":"Eränkävijäntaival","duration":31.111,"distance":228.526,"driving_side":"right","weight":43.106,"mode":"driving","geometry":{"coordinates":[[25.465967,65.079794],[25.465948,65.07988],[25.465904,65.080065],[25.46578,65.080452],[25.465755,65.080615],[25.465799,65.080771],[25.46582,65.080827],[25.466153,65.081264],[25.466416,65.081625],[25.466451,65.081715],[25.466484,65.081799]],"type":"LineString"}},{"intersections":[{"entry":[true,false,true],"in":1,"bearings":[91,189,356],"duration":3.159,"turn_weight":7,"turn_duration":1.47,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":0,"weight":8.52,"geometry_index":39,"location":[25.466484,65.081799]},{"bearings":[94,183,271,358],"entry":[true,false,false,false],"in":2,"turn_weight":2,"turn_duration":0.009,"mapbox_streets_v8":{"class":"street"},"is_urban":false,"admin_index":0,"out":0,"geometry_index":40,"location":[25.466664,65.081798]}],"speedLimitUnit":"km/h","maneuver":{"type":"turn","instruction":"Turn right onto Naalinkulku.","modifier":"right","bearing_after":91,"bearing_before":9,"location":[25.466484,65.081799]},"speedLimitSign":"vienna","name":"Naalinkulku","duration":7.934,"distance":32.273,"driving_side":"right","weight":15.08,"mode":"driving","geometry":{"coordinates":[[25.466484,65.081799],[25.466664,65.081798],[25.467171,65.081784]],"type":"LineString"}},{"intersections":[{"bearings":[90,174,274],"entry":[true,true,false],"classes":["restricted"],"in":2,"turn_weight":607,"turn_duration":1.246,"mapbox_streets_v8":{"class":"service"},"is_urban":false,"admin_index":0,"out":1,"geometry_index":41,"location":[25.467171,65.081784]}],"speedLimitUnit":"km/h","maneuver":{"type":"turn","instruction":"Turn right.","modifier":"right","bearing_after":174,"bearing_before":94,"location":[25.467171,65.081784]},"speedLimitSign":"vienna","name":"","duration":5.521,"distance":11.873,"driving_side":"right","weight":611.104,"mode":"driving","geometry":{"coordinates":[[25.467171,65.081784],[25.467199,65.081678]],"type":"LineString"}},{"intersections":[{"bearings":[354],"entry":[true],"in":0,"admin_index":0,"geometry_index":42,"location":[25.467199,65.081678]}],"speedLimitUnit":"km/h","maneuver":{"type":"arrive","instruction":"You have arrived at your destination.","bearing_after":0,"bearing_before":174,"location":[25.467199,65.081678]},"speedLimitSign":"vienna","name":"","duration":0,"distance":0,"driving_side":"right","weight":0,"mode":"driving","geometry":{"coordinates":[[25.467199,65.081678],[25.467199,65.081678]],"type":"LineString"}}],"distance":600.278,"summary":"Ketunlenkki, Eränkävijäntaival"}],"geometry":{"coordinates":[[25.467315,65.080339],[25.467318,65.080464],[25.467566,65.080464],[25.467892,65.080463],[25.468159,65.080462],[25.4685,65.080461],[25.468823,65.080461],[25.469016,65.08046],[25.46925,65.080459],[25.469251,65.080449],[25.469279,65.080225],[25.469314,65.079947],[25.469309,65.079904],[25.469284,65.079875],[25.469248,65.079854],[25.469211,65.079841],[25.469114,65.079828],[25.468997,65.079828],[25.468892,65.079828],[25.468682,65.079828],[25.468322,65.079829],[25.468035,65.079829],[25.467628,65.07983],[25.467455,65.07983],[25.467049,65.079831],[25.466837,65.079829],[25.466737,65.079829],[25.466443,65.079813],[25.466152,65.079798],[25.465967,65.079794],[25.465948,65.07988],[25.465904,65.080065],[25.46578,65.080452],[25.465755,65.080615],[25.465799,65.080771],[25.46582,65.080827],[25.466153,65.081264],[25.466416,65.081625],[25.466451,65.081715],[25.466484,65.081799],[25.466664,65.081798],[25.467171,65.081784],[25.467199,65.081678]],"type":"LineString"}}],"waypoints":[{"distance":11.632,"name":"","location":[25.467315,65.080339]},{"distance":16.421,"name":"","location":[25.467199,65.081678]}],"code":"Ok","uuid":"urmvxWwMSWbT0sr_qoPjdnv9vLt6uG_VohBDnAOlwh3wQvH9JzISeQ=="})";
    auto route = JsonParser::parseDirectionResponse(response);
    EXPECT_EQ(route->status, "Ok");
    EXPECT_EQ(route->legs.size(), 1);
    EXPECT_TRUE(route->distance > 340 && route->distance < 350);
    EXPECT_TRUE(route->duration > 1.9 * 60 && route->duration < 2 * 60);
    auto leg = route->legs[0];
    EXPECT_EQ(leg.distances.size(), leg.maxSpeeds.size()); // Make sure the annotation's size is correct
    auto edges = leg.edges;
    auto coordinatesSize = std::reduce(edges.begin() + 1, edges.end(), edges[0].coordinates.size() - 2,
                [] (int acc, const Edge& edge) {
                    return acc + edge.coordinates.size() - 1;
                });
    EXPECT_EQ(leg.distances.size(), coordinatesSize); // Make sure the annotation's size fits coordinates size
    auto edge3 = edges[3];
    EXPECT_TRUE(!edge3.maneuver.instruction.empty());
    EXPECT_TRUE(edge3.distance > 0);
    EXPECT_TRUE(edge3.duration > 0);
}

TEST(JsonParserTest, wrongResponse) {
    auto response = R"(bad response)";
    auto route = JsonParser::parseDirectionResponse(response);
    EXPECT_NE(route->status, "Ok");
}
